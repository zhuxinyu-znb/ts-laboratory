(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{1458:function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(4),a=n(8),r=n(7),i=n(5),s=n(6),m=n(0),c=n(1),d=n(113),l=(n(1645),function(e){function t(){return Object(o.a)(this,t),Object(r.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(a.a)(t,[{key:"render",value:function(){var e=this.props.onRef;return Object(m.b)("div",{className:"Comments-pattern-loading",ref:e},Object(m.b)(d.a,null))}}]),t}(c.PureComponent))},1461:function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(4),a=n(8),r=n(7),i=n(5),s=n(6),m=n(13),c=n(1),d=n(9),l=n.n(d),u=n(10),p=n(0),b=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,s=new Array(a),m=0;m<a;m++)s[m]=arguments[m];return(n=Object(r.a)(this,(e=Object(i.a)(t)).call.apply(e,[this].concat(s)))).handleClick=function(){var e=n.props;(0,e.onSelect)(e.page)},n}return Object(s.a)(t,e),Object(a.a)(t,[{key:"render",value:function(){var e=this.props,t=e.text,n=e.isCurrent,o=e.className;return Object(p.b)(u.c,{preset:u.b.Plain,className:l()("PaginationButton",{"PaginationButton--current":n},o),onClick:this.handleClick,disabled:n},t)}}]),t}(c.Component),C=(n(1644),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Array.from({length:t},function(t,n){return n+e})}),h=function(e){function t(){return Object(o.a)(this,t),Object(r.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(a.a)(t,[{key:"render",value:function(){var e,t=this.props,n=t.onSelect,o=t.className,a=t.clickCallback,r=this.props.current,i=this.props.total,s=a&&(e=a,function(){e.apply(void 0,arguments)})||n,c=function(e,t){var n="...";return t<=5?C(1,t):e>t-3?[1,n].concat(Object(m.a)(C(t-3,3)),[t]):e<=3?[1].concat(Object(m.a)(C(2,3)),[n,t]):[1,n].concat(Object(m.a)(C(e-Math.floor(1.5),3)),[n,t])}(r,i);return Object(p.b)("div",{className:l()("Pagination",o)},r>1&&r<=i&&Object(p.b)(b,{className:"PaginationButton-prev",onSelect:s,text:"上一页",page:r-1}),c.map(function(e,t){return"number"==typeof e?Object(p.b)(b,{onSelect:s,text:e,page:e,key:t,isCurrent:r===e}):Object(p.b)("button",{disabled:!0,key:t,className:"PaginationButton PaginationButton--ellipsis"},e)}),r>0&&r<i&&Object(p.b)(b,{className:"PaginationButton-next",onSelect:s,text:"下一页",page:r+1}))}}]),t}(c.Component);h.defaultProps={current:1,total:1,onSelect:function(){}}},1462:function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(14),a=n(0),r=n(1),i=n.n(r),s=n(125),m=n(17),c=function(e){return i.a.createElement(m.a,e,i.a.createElement("path",{d:"M12 11l-3.716 3.782a.758.758 0 0 1-1.064 0 .738.738 0 0 1 0-1.052l4.249-4.512a.758.758 0 0 1 1.064 0l4.246 4.512a.738.738 0 0 1 0 1.052.757.757 0 0 1-1.063 0L12.002 11z",fillRule:"evenodd"}))};c.defaultProps={name:"ArrowUp"};var d=c,l=n(89),u=n.n(l);n(1646);function p(e){var t=e.onClick,n=e.commentsElRef,r=i.a.useState(!1),m=Object(o.a)(r,2),c=m[0],l=m[1],p=i.a.useState(0),b=Object(o.a)(p,2),C=b[0],h=b[1];return i.a.useEffect(function(){var e=n.current;if(e){var t=e.getBoundingClientRect().right;h(t-16)}},[n]),i.a.useEffect(function(){var e=u()(function(){var e=n.current;if(e){var t=window.innerHeight,o=e.getBoundingClientRect(),a=o.top,r=o.bottom,i=o.height;l(i>500&&r>t&&a<0)}},100);return window.addEventListener("scroll",e),function(){e.cancel(),window.removeEventListener("scroll",e)}},[n]),Object(s.c)(c,null,{from:{opacity:0,left:C},enter:{opacity:1,left:C},leave:{opacity:0,left:C}}).map(function(e){var n=e.item,o=e.key,r=e.props;return n&&Object(a.b)(s.a.button,{key:o,style:r,onClick:t,className:"CommentCollapseButton"},"收起评论",Object(a.b)(d,{center:!0}))})}},1644:function(e,t,n){},1645:function(e,t,n){},1646:function(e,t,n){},1647:function(e,t,n){},1648:function(e,t,n){var o=n(707),a=n(285),r=n(418),i=Math.max,s=Math.min;e.exports=function(e,t,n){var m=null==e?0:e.length;if(!m)return-1;var c=m-1;return void 0!==n&&(c=r(n),c=n<0?i(m+c,0):s(c,m-1)),o(e,a(t,3),c,!0)}},1649:function(e,t,n){},1650:function(e,t,n){},1651:function(e,t,n){},1683:function(e,t,n){"use strict";n.r(t);var o=n(15),a=n(22),r=n(4),i=n(8),s=n(7),m=n(5),c=n(6),d=n(0),l=n(1),u=n.n(l),p=n(2),b=n.n(p),C=n(31),h=n(12),v=n(30),f=n(9),O=n.n(f),j=n(316),g=n(1648),y=n.n(g),k=n(60),P=n(1461),I=n(42),N=n(26),w=n(47),R=n(130),D=n(27),L=n(72),S=n(486),F=n(625),T=n(1458),A=n(485),B=n(1462),E=n(494),x=n(3),V=n(10),M=(n(1649),5),q=2,_=function(e){function t(){var e,n;Object(r.a)(this,t);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return(n=Object(s.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(a)))).state={},n.handleClick=function(){var e=n.props,t=e.loadRestComments,o=e.onShowConversation,a=e.comment,r=a.id,i=a.childCommentCount,s=i<=M&&i>q;(s?t:o)({commentId:r}),s&&n.setState(Object(x.a)({},"hide_".concat(r),!0))},n.handleRef=function(e){var t=n.props.onRef;"function"==typeof t&&t(e)},n}return Object(c.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props,t=e.comment,n=t.id,o=t.childCommentCount,a=e.isFetching,r=e.className,i=this.state["hide_".concat(n)],s=o<=M&&o>q?"展开其他 ".concat(o-q," 条回复"):"查看全部 ".concat(o," 条回复");return Object(d.b)("div",{className:r,ref:this.handleRef},!i&&Object(d.b)("div",{className:"CommentMoreReplyButton"},Object(d.b)(V.c,{preset:"plain",onClick:this.handleClick},s)),a&&Object(d.b)(k.a,{className:"CommentMoreReplyButton",small:!0}))}}]),t}(l.Component);_.propTypes={comment:b.a.object.isRequired,isFetching:b.a.bool,onShowConversation:b.a.func,loadRestComments:b.a.func};n(1650);var U,W=Object(h.connect)(null,{loadConversation:j.h})(U=function(e){function t(){var e,n;Object(r.a)(this,t);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return(n=Object(s.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(a)))).loadRestComments=function(e){var t=e.commentId;(0,n.props.loadConversation)({id:t,isLoadRest:!0})},n}return Object(c.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props,t=e.parent,n=t.type,o=t.author,a=(o=void 0===o?{isOrg:!1}:o).isOrg,r=e.parent,i=e.commentNeedsReview,s=e.onShowConversation,m=e.status,c=e.onItemLike,u=e.onItemDelete,p=e.onItemCollapse,b=e.onItemDislike,C=e.onItemApprove,h=e.onItemReject,v=e.canOperateItem,f=e.commentPattern,j=e.conversation,g=void 0===j?{}:j,y=e.entities,k=e.byComment,P=e.isReverseAndStatusOpen,I=e.comment,N=e.onReply,w=e.onFeature,R=e.ids,D=e.showCollapsed,L=I.id,S=I.featured,F=I.childComments,T=void 0===F?[]:F,A=I.childCommentCount,B=void 0===A?0:A,x=S?"".concat(L,"_featured"):"".concat(L),V=!S&&R.includes("".concat(L,"_featured")),M=Boolean(T.length)&&!P,q=B<=5&&B>2,U=T.map(function(e){return y.comments[e]}),W=!S&&B>2&&!P,z=(q&&g[L]||{isFetching:!1}).isFetching;return Object(d.b)(l.Fragment,null,Object(d.b)("li",{className:O()({"NestComment--rootCommentNoChild":!M,"NestComment--rootComment":M}),key:x},Object(d.b)(E.a,{key:x,comment:I,status:m,type:n,parent:r,canOperate:v,commentNeedsReview:i,onShowConversation:s,ownerAuthorIsOrg:a,onLike:c,onReply:N,onFeature:w,onDelete:u,onCollapse:p,onDislike:b,onApprove:C,onReject:h,commentPattern:f,rootCommentId:L,byComment:k,isReverseAndStatusOpen:P,hasRecommend:V,showCollapsed:D})),M&&U.map(function(e){var t=e.id,o=e.featured,l=o?"".concat(t,"_featured"):"".concat(t),O=!o&&R.includes("".concat(t,"_featured"));return Object(d.b)("li",{className:"NestComment--child",key:l},Object(d.b)(E.a,{key:l,comment:e,status:m,type:n,parent:r,canOperate:v,commentNeedsReview:i,onShowConversation:s,ownerAuthorIsOrg:a,onLike:c,onReply:N,onFeature:w,onDelete:u,onCollapse:p,onDislike:b,onApprove:C,onReject:h,commentPattern:f,rootCommentId:L,hasRecommend:O,showCollapsed:D}))}),W&&Object(d.b)(_,{comment:I,isFetching:z,onShowConversation:s,loadRestComments:this.loadRestComments}))}}]),t}(l.Component))||U;function z(e){var t=e.id,n=e.replyTo,o=e.isConversation;if(e.isNotification)return{type:"notification"};if(o)return{type:"conversation"};if(!n)return{type:"comment"};var a=n.featured,r=n.replyToAuthor,i=n.id;return t===i&&a?r?{type:"replyToSubFeatured"}:{type:"replyToFeatured"}:t!==i||r?t!==i&&r?{type:"replyToSubCommon"}:{type:"comment"}:{type:"replyToCommon"}}n(1651);var H=function(e){function t(){var e,n;Object(r.a)(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return(n=Object(s.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(i)))).state={collapsed:!0,current:1},n.commentsWithPaginationElRef=u.a.createRef(),n.load=function(e,t,o){if(!n.props.isFetching&&!n.props.parent.adminClosedComment){var a=e||n.props,r=a.order,i=a.status,s=a.parent,m=s.id,c=s.type,d=a.commentPattern,l=a.needLoadCommentPermission,u=a.loadComments,p=a.notificationId,b=a.loadNotificationComments;if(p)return b(p);l&&n.loadCommentPermission(c,m),u(c,m,{order:r,isPrevious:t,commentPattern:d,status:o?"collapsed":i},o)}},n.addComment=function(e,t,o,a,r){var i=o.rootCommentId,s=o.isConversation,m=n.props,c=m.parent,d=c.id,l=c.type,u=m.commentId,p=m.addComment,b=m.notificationId;return p({parentType:l,parentId:d,content:e,replyTo:t,conversationId:u,rootCommentId:i,isConversation:s,notificationId:b,replyType:z({id:i,replyTo:t,isConversation:s,isNotification:Boolean(b)}).type,useStrictMode:a,enableUnfriendlyCheck:r})},n.featureItem=function(e){(0,n.props.onItemFeature)(e,n.lastFeaturedIndex)},n.handleOpenCollapsed=function(){n.setState({collapsed:!1}),n.load(n.props,!1,!0)},n.handlePageSelect=function(e){var t=n.props.onPaginationClick,o=n.state.current;t&&t(o,e),n.commentsElement.scrollIntoView(),n.setState({current:e}),n.loadByPagination(e)},n.loadByPagination=function(e,t){var o=t||n.props,a=o.order,r=o.status,i=o.parent,s=i.id,m=i.type,c=o.commentPattern,d=o.needLoadCommentPermission,l=o.loadComments;d&&n.loadCommentPermission(m,s),l(m,s,{order:a,isPrevious:!1,status:r,commentPattern:c,current:e})},n.renderComment=function(e){var t=e.id,a=e.featured?"".concat(t,"_featured"):t,r=!n.state.collapsed;return Object(d.b)("ul",{className:"NestComment",key:a},Object(d.b)(W,Object(o.default)({comment:e,onReply:n.addComment,onFeature:n.featureItem,showCollapsed:r},n.props)))},n.renderNormalComments=function(e){var t=n.state.collapsed,o=n.props,a=o.byComment,r=o.lastFeaturedIndex,i=o.parent,s=i.featuredCounts,m=i.commonCounts,c=[],l=s>0;return n.lastFeaturedIndex=0,e.length>0&&e.forEach(function(o,i){if(a||!o.collapsed){var u=e[i-1];o.collapsed&&(u&&u.collapsed||c.push(n.renderCollapsedDivider()),t)||(i===r&&c.push(Object(d.b)("div",{className:"NestComment-nextSiblings--noBorder",key:"NestComment-nextSiblings--noBorder"})),l&&0===i&&-1!==r&&c.push(Object(d.b)("div",{className:"CommentListV2-header-divider",key:"divider-featured"},"精选评论（",s,"）")),c.push(n.renderComment(o)),i===r&&(n.lastFeaturedIndex=i,c.push(Object(d.b)("div",{className:"CommentListV2-header-divider",key:"divider-comment"},"评论（",m,"）"))))}}),c},n.renderCollapsedComments=function(){var e=n.props,t=e.collapsedComments,o=e.isDrained,a=e.parent,r=(a=void 0===a?{}:a).collapsedCounts;return!o||r<=0?[]:t.map(function(e){return n.renderComment(e)})},n.renderComments=function(e){return e.map(n.renderComment)},n.renderCollapsedDivider=function(){var e=n.props,t=e.isDrained,o=e.parent.collapsedCounts;return!t||o<=0?[]:n.state.collapsed?Object(d.b)("div",{className:"CommentListV2-action",key:"collapsed"},Object(d.b)("div",{className:"CommentListV2-expendCollapseButton"},Object(d.b)("span",{onClick:n.handleOpenCollapsed},Object(I.formatNumber)(o)," 条评论被折叠"),"（",Object(d.b)("a",{href:"//www.zhihu.com/question/52029856/answer/128623557",target:"_blank",rel:"noopener noreferrer"},"为什么？"),"）")):Object(d.b)("div",{className:"CommentListV2-divider",key:"divider-collapsed"},Object(d.b)("div",{className:"CommentListV2-dividerLine"}),Object(d.b)("div",{className:"CommentListV2-dividerText"},Object(I.formatNumber)(o)," 条评论被折叠（",Object(d.b)("a",{href:"//www.zhihu.com/question/52029856/answer/128623557",target:"_blank",rel:"noopener noreferrer"},"为什么？"),"）"))},n.renderCollapsedInfiLoader=function(){var e=n.state.collapsed;if(e)return[];var t=n.props.collapsedInfo,o=void 0===t?{}:t,a=o.isFetching,r=void 0!==a&&a,i=o.isPrevDrained,s=void 0!==i&&i,m=o.isDrained,c=void 0!==m&&m;return Object(d.b)(k.b,{className:"CommentListV2",onRef:function(e){n.listEl=e},isLocal:!0,isLoading:r,isPrevDrained:s,isDrained:c,onLoad:function(t){return n.load(n.props,t,!e)},placeholder:Object(d.b)(k.a,{className:"CommentItem",small:!0})},n.renderCollapsedComments())},n.renderPatternContent=function(e){var t=n.props,o=t.isFetching,a=t.parent.adminClosedComment,r=t.byComment,i=t.status,s=t.order,m=t.totals,c=t.showPackupButton,l=t.handlePackupButton,u=Math.ceil(m/20),p=n.state.current;return a?null:o?Object(d.b)(T.a,null):Object(d.b)("div",{ref:n.commentsWithPaginationElRef},Object(d.b)("div",{className:"CommentListV2"},"normal"===s&&"open"===i?n.renderNormalComments(e):n.renderComments(e)),u>1&&Object(d.b)(P.a,{className:"CommentsV2-pagination",current:p,total:u,onSelect:n.handlePageSelect}),!r&&n.renderCollapsedDivider(),!r&&n.renderCollapsedInfiLoader(),c&&Object(d.b)(B.a,{onClick:l,commentsElRef:n.commentsWithPaginationElRef}))},n.renderModalContent=function(e){var t=n.props,o=t.collapsedInfo,a=t.parent.adminClosedComment,r=t.status,i=t.order,s=t.byComment,m=n.state.collapsed,c=m?n.props:o,l=c.isFetching,u=void 0!==l&&l,p=c.isDrained,b=void 0!==p&&p,C=c.isPrevDrained,h=void 0!==C&&C;return b&&e.length<=0||a?Object(d.b)("div",{className:"CommentsV2-empty"},Object(d.b)(S.d,null,Object(d.b)(S.a,null),Object(d.b)("div",null,"还没有评论"))):Object(d.b)(k.b,{className:"CommentListV2",onRef:function(e){n.listEl=e},isLocal:!0,isLoading:u,isPrevDrained:h,isDrained:b,onLoad:function(e){return n.load(n.props,e,!m)},placeholder:Object(d.b)(k.a,{className:"CommentItemV2",small:!0}),getContainer:function(e){return e}},"normal"===i&&"open"===r?n.renderNormalComments(e):n.renderComments(e),!s&&n.renderCollapsedDivider(),!s&&n.renderCollapsedComments())},n.renderCommentEdit=function(){var e=n.props,t=e.parent,o=t.canComment,a=(o=void 0===o?{status:!0}:o).status,r=o.reason,i=t.author,s=(i=void 0===i?{isOrg:!1}:i).isOrg,m=t.type,c=t.id,l=t.adminClosedComment,u=t.questionType,p=e.byComment,b=e.autoFocus,C=e.commentNeedsReview,h=e.zaInfo,v=l?"当前内容暂时无法评论":r,f=b&&!p;return a&&!l?Object(d.b)(F.a,{className:"CommentsV2-footer",type:m,id:c,commentNeedsReview:C,onSubmit:n.addComment,autoFocus:f,ownerAuthorIsOrg:s,ownerAuthorIsBrand:"commercial"===u,zaInfo:h}):Object(d.b)("div",{className:O()("CommentsV2-disabledText")},Object(d.b)("div",{className:"CommentsV2-disabledReason"},v))},n}return Object(c.a)(t,e),Object(i.a)(t,[{key:"loadCommentPermission",value:function(e,t){var n=this.props,o=n.loadAnswerCommentPermission,a=n.loadArticleCommentPermission;switch(e){case"answer":return o(t);case"article":return a(t);default:return null}}},{key:"componentDidMount",value:function(){var e=this.props,t=e.commentPattern,n=e.parent.adminClosedComment,o=e.stickers,a=e.loadStickers,r=e.getCommentWithPicPermission,i=e.commentWithPicPermission,s=e.currentUser;n||"bottom"!==t||this.loadByPagination(this.state.current),!o.length&&a(),void 0===i.commentWithPic&&s&&r()}},{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=t.order,o=t.status,a=t.targetComment,r=t.commentPattern;n===e.order&&o===e.status||("bottom"===r?(this.setState({current:1}),this.loadByPagination(1,e)):this.load(e),this.setState({collapsed:!0}));var i=e.targetComment;i!==a&&i&&this.setState({collapsed:i.collapsed})}},{key:"componentWillUnmount",value:function(){Object(N.d)(N.b)}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,a=t.comments,r=t.commentPattern,i=t.commentInputPosition,s=t.isAuthor,m=t.parent,c=m.author,l=(c=void 0===c?{isOrg:!1}:c).isOrg,u=m.commentPermission,p=m.reviewingCounts,b=m.commentCount,C=m.adminClosedComment,h=t.totals,v=t.status,f=t.order,j=t.onStatusChange,g=t.onOrderChange,y=t.targetLink,k=t.shouldReverse,P=t.permission.canBrandAdminEdit,I="censor"===u&&(s||P),N=I?{isCommentReviewer:I,onStatusChange:j,status:v,reviewingCounts:p}:{status:v};return Object(d.b)("div",{className:O()("CommentsV2 CommentsV2--withEditor",{"CommentsV2-withPagination":"bottom"===r},n),ref:function(t){e.commentsElement=t}},Object(d.b)(A.a,Object(o.default)({commentCount:void 0!==b?b:h,shouldReverse:k,commentClosed:C,targetLink:y,order:f,onOrderChange:g,commentPattern:r,isOrg:l},N)),"top"===i&&this.renderCommentEdit(),"bottom"===r?this.renderPatternContent(a):this.renderModalContent(a),"bottom"===i&&this.renderCommentEdit())}}]),t}(l.Component);H.propTypes={type:b.a.string,parent:b.a.object.isRequired,targetLink:b.a.node,commentNeedsReview:b.a.bool,byComment:b.a.oneOfType([b.a.number,b.a.string]),commentPattern:b.a.string,commentInputPosition:b.a.oneOf(["top","bottom"]),showPackupButton:b.a.bool,handlePackupButton:b.a.func,onPaginationClick:b.a.func,autoFocus:b.a.bool,shouldReverse:b.a.bool},H.contextTypes={authRequired:b.a.func.isRequired},H.defaultProps={commentInputPosition:"bottom",showPackupButton:!0,autoFocus:!0,shouldReverse:!0};var J,G,K,Q=Object(h.connect)(function(e,t){var n=t.parent,o=t.parent,a=o.type,r=o.id,i=t.status,s=t.order,m=t.byComment,c=t.commentPattern,d=t.notificationId,l=e.entities,u=e.commentsV2,p=u.conversation,b=u.stickers,C=void 0===b?[]:b,h=u.commentWithPicPermission,v=u.notificationsComments,f=u.parent,O=l.comments[m],j=u.pagination;"reviewing"===i&&(j=u.reviewing);var g="reverse"===s&&"open"===i;g&&(j=u.reverse);var k="".concat(a,"_").concat(r),P=[],I=u.collapsed[k]||{};I.ids&&I.ids.length>0&&(P=I.ids.map(function(e){return l.comments[e]})),d&&(j=v,k=d);var N=j[k]||{isPrevDrained:!1,isFetching:!1,isDrained:!1,ids:[]},w=N.isFetching,R=N.isPrevDrained,S=N.isDrained,F=N.ids,T=N.newIds,A=void 0===T?[]:T,B=N.totals,E="bottom"!==c?F:A,x=E.map(function(e){return l.comments[e]}),V=y()(E,function(e){return String(e).includes("_featured")});return{currentUser:Object(D.b)(e),isFetching:w,isPrevDrained:R,isDrained:S,totals:d?x.length:B,collapsedInfo:I,collapsedComments:P,targetComment:O,conversation:p,entities:l,stickers:C,lastFeaturedIndex:V,comments:x,isReverseAndStatusOpen:g,commentWithPicPermission:h,ids:E,parent:Object.assign({},n,{},f[k]),permission:Object(L.k)(e)}},{loadComments:j.g,loadConversation:j.h,addComment:j.a,loadStickers:j.k,clearNotification:N.d,getCommentWithPicPermission:j.f,loadNotificationComments:j.j,loadAnswerCommentPermission:w.j,loadArticleCommentPermission:R.b})(H),X=n(32),Y=n(13),Z=n(129),$=n.n(Z),ee=n(236),te=n.n(ee),ne=n(41),oe=n(1366),ae=Object(h.connect)(function(e,t){var n=t.conversationId,o=t.isAnchorComments,a=e.entities.comments,r=e.commentsV2,i=r.conversation,s=r.conversationMore,m=i[n]||{isFetching:!1,isDrained:!1,isPrevDrained:!1,ids:[]},c=m.isFetching,d=m.isDrained,l=m.isPrevDrained,u=m.ids,p=m.totals,b=m.topComments,C=(b=void 0===b?{}:b).paging,h=(C||{}).isEnd,v=s[n]||{isFetching:!1,isDrained:!1,ids:[]},f=v.isFetching,O=v.isDrained,j=v.ids,g=j.map(function(e){return a[e]}),y=u.map(function(e){return a[e]}),k=a["".concat(n,"_featured")]||a[n]||{},P=o?te()(j.length?[].concat(Object(Y.a)(y.slice(0,4)),Object(Y.a)(g),Object(Y.a)(y.slice(4))):y,"id"):[k].concat(Object(Y.a)(y)),I=C?[].concat(Object(Y.a)(y.slice(0,3)),Object(Y.a)(g)).length:-1;return{isFetching:c,isDrained:d,isPrevDrained:l,totals:p,comments:P,openComment:k,topCommentsPaging:C,isConversationMoreFetching:f,isConversationMoreDrained:h||O,offsetIndex:I}},{loadConversation:j.h,addComment:j.a,loadMoreAnchorComments:j.i})((K=G=function(e){function t(){var e,n;Object(r.a)(this,t);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return(n=Object(s.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(a)))).load=function(){var e=n.props,t=e.isAnchorComments,o=e.conversationId;(0,e.loadConversation)({id:o,isAnchorComments:t})},n.addComment=function(e,t,o){var a=o.rootCommentId,r=o.isConversation,i=n.props,s=i.parent,m=s.type,c=s.id,d=i.conversationId,l=i.addComment,u=i.isAnchorComments;return l({parentType:m,parentId:c,content:e,replyTo:t,conversationId:d,rootCommentId:a,isConversation:r,replyType:z({id:a,replyTo:t,isConversation:r}).type,isAnchorComments:u})},n.loadMoreAnchorComments=function(){var e=n.props,t=e.conversationId,o=e.topCommentsPaging,a=void 0===o?{}:o;(0,e.loadMoreAnchorComments)({conversationId:t,nextUrl:a.next})},n.createOnRef=$()(function(e){return function(t){var o=n.props.byComment;t&&o&&String(e)===String(o)&&(n.byCommentNode=t)}}),n.scrollToTarget=function(){var e=Object(X.default)(n),t=e.byCommentNode,o=e.listEl;if(o&&t){var a=t.getBoundingClientRect(),r=a.top,i=a.height,s=o.getBoundingClientRect(),m=s.top,c=s.height;n.listEl.scrollTop+=r-m-(c-i)/2,t.classList.add("CommentItemV2--highlighted"),setTimeout(function(){return t.classList.remove("CommentItemV2--highlighted")},2e3),t.tabIndex=-1,t.focus()}},n}return Object(c.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){this.props.byComment&&this.scrollToTarget()}},{key:"componentDidUpdate",value:function(e){!e.comments.length&&this.props.comments.length&&this.props.byComment&&this.scrollToTarget()}},{key:"render",value:function(){var e=this,t=this.props,n=t.onItemLike,o=t.onItemDelete,a=t.onItemFeature,r=t.onItemApprove,i=t.onItemCollapse,s=t.onItemDislike,m=t.onNavBack,c=t.canOperateItem,p=t.isFetching,b=t.comments,C=void 0===b?[]:b,h=t.commentNeedsReview,v=t.openComment.collapsed,f=t.parent,O=t.commentPattern,j=t.totals,g=t.isDrained,y=t.isPrevDrained,P=t.isConversationMoreFetching,I=t.isConversationMoreDrained,N=t.offsetIndex,w=null;return p&&!C.length?w=Object(d.b)(u.a.Fragment,null,Object(d.b)(k.a,{className:"CommentItemV2",small:!0}),Object(d.b)("div",{className:"CommentsV2-openComment-divider"}),Object(d.b)("div",{className:"CommentsV2-replyNum"},"".concat(j," 条回复"))):C.length&&(w=C.map(function(t,m){return m?I||m!==N||P?P&&m===N?Object(d.b)(l.Fragment,{key:t.id},Object(d.b)(E.a,{key:t.id,onRef:e.createOnRef(t.id),isConversation:!0,commentNeedsReview:h,canOperate:c,parent:f,comment:t,onLike:n,onDelete:o,onFeature:a,onApprove:r,onCollapse:i,onDislike:s,collapsedShown:v,onReply:e.addComment}),Object(d.b)(k.a,{key:"NestCoomment-moreCommentButton-PlaceHolder",className:"NestCoomment-moreCommentButton ",small:!0})):Object(d.b)(E.a,{key:t.id,onRef:e.createOnRef(t.id),isConversation:!0,commentNeedsReview:h,canOperate:c,parent:f,comment:t,onLike:n,onDelete:o,onFeature:a,onApprove:r,onCollapse:i,onDislike:s,collapsedShown:v,onReply:e.addComment}):Object(d.b)(l.Fragment,{key:t.id},Object(d.b)(E.a,{key:t.id,onRef:e.createOnRef(t.id),isConversation:!0,commentNeedsReview:h,canOperate:c,parent:f,comment:t,onLike:n,onDelete:o,onFeature:a,onApprove:r,onCollapse:i,onDislike:s,collapsedShown:v,onReply:e.addComment}),Object(d.b)("div",{key:"NestCoomment-moreCommentButton",preset:"plain",className:"NestCoomment-moreCommentButton",onClick:e.loadMoreAnchorComments},Object(d.b)(oe.a,null),Object(d.b)("p",null,"点击查看更多回复"))):Object(d.b)(l.Fragment,{key:t.id},Object(d.b)("div",{className:"CommentsV2-openComment"},Object(d.b)(E.a,{key:t.id,onRef:e.createOnRef(t.id),isConversation:!0,commentNeedsReview:h,canOperate:c,parent:f,comment:t,onLike:n,onDelete:o,onFeature:a,onApprove:r,onCollapse:i,onDislike:s,collapsedShown:v,onReply:e.addComment})),Object(d.b)("div",{className:"CommentsV2-openComment-divider"}),Object(d.b)("div",{key:"".concat(t.id,"-title")},Object(d.b)("div",{className:"CommentsV2-replyNum"},"".concat(j," 条回复"))))})),"bottom"===O?Object(d.b)(ne.b,{size:"fullPage",onClose:m},Object(d.b)("div",{className:"CommentsV2"},Object(d.b)(A.a,{isConversation:!0,commentPattern:O}),Object(d.b)(k.b,{className:"CommentListV2",onRef:function(t){e.listEl=t},isLocal:!0,isLoading:p,isDrained:g,isPrevDrained:y,onLoad:this.load,placeholder:Object(d.b)(k.a,{className:"CommentItemV2",small:!0}),getContainer:function(e){return e}},w))):Object(d.b)("div",{className:"CommentsV2"},Object(d.b)(A.a,{isConversation:!0,onNavBack:m}),Object(d.b)(k.b,{className:"CommentListV2",onRef:function(t){e.listEl=t},isLocal:!0,isLoading:p,isDrained:g,isPrevDrained:y,onLoad:this.load,placeholder:Object(d.b)(k.a,{className:"CommentItemV2",small:!0}),getContainer:function(e){return e}},w))}}]),t}(l.Component),G.propTypes={conversationId:b.a.oneOfType([b.a.number,b.a.string]),type:b.a.string,parent:b.a.object.isRequired,commentNeedsReview:b.a.bool},G.contextTypes={currentUser:b.a.object,authRequired:b.a.func.isRequired},J=K))||J;var re=n(67),ie=function(e){function t(){var e,n;Object(r.a)(this,t);for(var o=arguments.length,a=new Array(o),i=0;i<o;i++)a[i]=arguments[i];return(n=Object(s.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(a)))).state={openedCommentId:n.props.byComment,isAnchorComments:Boolean(n.props.byComment),status:"open",order:"normal"},n.commentsContainerRef=Object(l.createRef)(),n.showConversation=function(e){var t=e.commentId,o=e.isAnchorComments;n.setState({openedCommentId:t,isAnchorComments:o})},n.showComments=function(){var e=n.props,t=e.byComment,o=e.router;t&&o.replace("".concat(location.pathname).concat(location.search)),n.setState({openedCommentId:null,isAnchorComments:!1})},n.delete=function(e){var t=n.props,o=t.parent;return(0,t.deleteComment)(e,o.type,o.id)},n.feature=function(e){var t=n.props,o=t.parent,a=t.updateCommentFeatureStatus,r=t.notificationId;a({id:n.state.openedCommentId,commentId:e,parentId:o.id,parentType:o.type,notificationId:r})},n.like=function(e,t){var o=n.props,a=o.onItemLike,r=o.updateCommentLikeStatus;a&&a(e,t),r(e)},n.collapse=function(e){var t=n.props,o=t.parent;(0,t.updateCommentCollapsed)(e,o.type,o.id)},n.dislike=function(e){(0,n.props.updateCommentDisliked)(e)},n.approve=function(e){var t=n.props,o=t.parent,a=t.type;(0,t.approveComment)(e,o.type||a,o.id)},n.reject=function(e){var t=n.props,o=t.parent,a=t.type;(0,t.rejectComment)(e,o.type||a,o.id)},n.handleStatusChange=function(e){n.setState({status:e})},n.handleOrderChange=function(e,t){var o=n.props.onOrderChange;o&&o(e,t),n.setState({order:e})},n}return Object(c.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.onMount;e&&e(this.commentsContainerRef.current)}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.containerClassName,r=e.parent,i=e.commentPattern,s=e.type,m=e.parent,c=(m=void 0===m?{}:m).commentPermission,l=m.relationship,u=void 0===l?{}:l,p=m.author,b=void 0===p?{}:p,C=e.needLoadCommentPermission,h=Object(a.a)(e,["className","containerClassName","parent","commentPattern","type","parent","needLoadCommentPermission"]),v=this.context.currentUser,f=void 0===u.isAuthor?v&&b.urlToken&&v.urlToken===b.urlToken:u.isAuthor,j="censor"===c&&!f,g="answer"===s||"article"===s,y=this.state,k=y.openedCommentId,P=y.isAnchorComments,I=y.status,N=y.order,w=k,R=Boolean(k&&"bottom"!==i);return Object(d.b)("div",{className:O()("Comments-container",n),ref:this.commentsContainerRef},Object(d.b)(Q,Object(o.default)({className:O()(t,{"CommentsV2--hidden":R})},h,{type:s,order:N,status:I,parent:r,commentPattern:i,commentNeedsReview:j,canOperateItem:g,onShowConversation:this.showConversation,onItemLike:this.like,onItemFeature:this.feature,onItemDelete:this.delete,onItemCollapse:this.collapse,onItemDislike:this.dislike,onItemApprove:this.approve,onItemReject:this.reject,byComment:w,onStatusChange:this.handleStatusChange,onOrderChange:this.handleOrderChange,needLoadCommentPermission:C,isAuthor:f})),k&&Object(d.b)(ae,Object(o.default)({},h,{parent:r,type:s,canOperateItem:g,onItemLike:this.like,onItemFeature:this.feature,onItemDelete:this.delete,onItemCollapse:this.collapse,onItemDislike:this.dislike,onItemApprove:this.approve,onItemReject:this.reject,commentPattern:i,conversationId:k,onNavBack:this.showComments,byComment:w,isAnchorComments:P,commentNeedsReview:j,onShowConversation:this.showConversation})))}}]),t}(l.Component);ie.propTypes={type:b.a.string.isRequired,parent:b.a.object.isRequired,onOrderChange:b.a.func,onItemLike:b.a.func,isAuthor:b.a.bool,onMount:b.a.func},ie.defaultProps={type:"answer"},ie.contextTypes={currentUser:b.a.object,authRequired:b.a.func.isRequired};t.default=Object(v.compose)(Object(re.a)(null),C.withRouter,Object(h.connect)(null,{updateCommentLikeStatus:j.p,updateCommentFeatureStatus:j.o,deleteComment:j.e,updateCommentCollapsed:j.m,updateCommentDisliked:j.n,approveComment:j.b,rejectComment:j.l}))(ie)},1688:function(e,t,n){"use strict";n.r(t);var o=n(15),a=n(22),r=n(4),i=n(8),s=n(7),m=n(5),c=n(6),d=n(0),l=n(2),u=n.n(l),p=n(1),b=n.n(p),C=n(12),h=n(9),v=n.n(h),f=n(137),O=n(11),j=n(129),g=n.n(j),y=n(1360),k=n(92),P=n(60),I=n(1461),N=n(10),w=n(42),R=n(97),D=n(26),L=n(47),S=n(130),F=n(486),T=n(492),A=n(491),B=n(1458),E=n(485),x=n(1462);n(1647);function V(e,t){switch(e){case"answer":return Object(L.j)(t);case"article":return Object(S.b)(t);default:return null}}var M=function(e){function t(){var e,n;Object(r.a)(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return(n=Object(s.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(i)))).state={collapsed:!0,current:1},n.commentsWithPaginationElRef=b.a.createRef(),n.load=function(e,t,o){if(!n.props.isFetching&&!n.props.parent.adminClosedComment){var a=e||n.props,r=a.order,i=a.byComment,s=a.status,m=a.parent,c=m.id,d=m.type,l=a.dispatch,u=a.commentPattern;if(a.needLoadCommentPermission&&V(d,c)&&l(V(d,c)),o){l(Object(f.e)(d,c,{order:r,isPrevious:t,byComment:i,status:"collapsed",commentPattern:u},!0))}else l(Object(f.e)(d,c,{order:r,isPrevious:t,byComment:i,status:s,commentPattern:u}))}},n.addComment=function(e,t){var o=n.props,a=o.parent,r=a.id,i=a.type,s=o.dispatch,m=[i,r,e];return t&&(m[3]=t.id),s(f.a.apply(void 0,m))},n.featureItem=function(e){n.props.onItemFeature(e,n.lastFeaturedIndex)},n.handleOpenCollapsed=function(){n.setState({collapsed:!1}),n.load(n.props,!1,!0)},n.createOnRef=g()(function(e){return function(t){var o=n.props.byComment;e===Number(o)&&(n.targetCommentEl=t)}}),n.handlePageSelect=function(e){var t=n.props.onPaginationClick,o=n.state.current;t&&t(o,e),n.commentsElement.scrollIntoView(),n.setState({current:e}),n.loadByPagination(e)},n.loadByPagination=function(e,t){var o=t||n.props,a=o.order,r=o.byComment,i=o.status,s=o.parent,m=s.id,c=s.type,d=o.dispatch,l=o.commentPattern;o.needLoadCommentPermission&&V(c,m)&&d(V(c,m)),d(Object(f.e)(c,m,{order:a,isPrevious:!1,byComment:r,status:i,commentPattern:l,current:e}))},n.renderComment=function(e){var t=n.props,o=t.parent,a=o.type,r=o.author,i=(r=void 0===r?{isOrg:!1}:r).isOrg,s=t.isMobile,m=t.parent,c=t.commentNeedsReview,l=t.onShowConversation,u=t.status,p=t.onItemLike,b=t.onItemDelete,C=t.onItemCollapse,h=t.onItemDislike,v=t.onItemApprove,f=t.canOperateItem,O=t.commentPattern;return Object(d.b)(A.a,{key:e.id,isMobile:s,comment:e,onRef:n.createOnRef(e.id),status:u,type:a,parent:m,canOperate:f,commentNeedsReview:c,onShowConversation:l,ownerAuthorIsOrg:i,onLike:p,onReply:n.addComment,onFeature:n.featureItem,onDelete:b,onCollapse:C,onDislike:h,onApprove:v,commentPattern:O})},n.renderNormalComments=function(e){var t=n.state.collapsed,o=n.props.byComment,a=[];if(n.lastFeaturedIndex=0,e.length>0){var r=e[0].featured,i=!1;e.forEach(function(s,m){if(o||!s.collapsed){var c=e[m-1];if(!s.collapsed||(c&&c.collapsed||a.push(n.renderCollapsedDivider()),!t)){a.push(n.renderComment(s));var l=e[m+1];r&&!i&&s.featured&&(!l||!l.featured)&&(i=!0,n.lastFeaturedIndex=m,a.push(Object(d.b)("div",{className:"CommentList-divider",key:"divider-featured"},Object(d.b)("div",{className:"CommentList-dividerLine"}),Object(d.b)("div",{className:"CommentList-dividerText"},"以上为精选评论",Object(d.b)(y.a,{className:"CommentList-questionMark","data-tooltip":"精选评论包含回答作者推荐的评论和部分高赞评论",center:!0,size:16})))))}}})}return a},n.renderCollapsedComments=function(){var e=[],t=n.props.collapsedComments;return n.state.collapsed||!t||t.length<=0?[]:(e.push(t.map(function(e){return n.renderComment(e)})),e)},n.renderComments=function(e){return e.map(n.renderComment)},n.renderCollapsedDivider=function(){var e=n.props,t=e.isDrained,o=e.parent.collapsedCounts;return!t||o<=0?[]:n.state.collapsed?Object(d.b)("div",{className:"CommentList-action",key:"collapsed"},Object(d.b)("div",{className:"CommentList-expendCollapseButton"},Object(d.b)("span",{onClick:n.handleOpenCollapsed},Object(w.formatNumber)(o)," 条评论被折叠"),"（",Object(d.b)("a",{href:"//www.zhihu.com/question/52029856/answer/128623557",target:"_blank",rel:"noopener noreferrer"},"为什么？"),"）")):Object(d.b)("div",{className:"CommentList-divider",key:"divider-collapsed"},Object(d.b)("div",{className:"CommentList-dividerLine"}),Object(d.b)("div",{className:"CommentList-dividerText"},Object(w.formatNumber)(o)," 条评论被折叠（",Object(d.b)("a",{href:"//www.zhihu.com/question/52029856/answer/128623557",target:"_blank",rel:"noopener noreferrer"},"为什么？"),"）"))},n.renderCollapsedInfiLoader=function(){var e=n.state.collapsed;if(e)return[];var t=n.props.collapsedInfo,o=(t=void 0===t?{}:t).isFetching,a=t.isPrevDrained,r=t.isDrained;return Object(d.b)(P.b,{className:"CommentList",onRef:function(e){n.listEl=e},isLocal:!0,isLoading:o,isPrevDrained:a,isDrained:r,onLoad:function(t){return n.load(n.props,t,!e)},placeholder:Object(d.b)(P.a,{className:"CommentItem",small:!0})},n.renderCollapsedComments())},n.renderPatternContent=function(e){var t=n.props,o=t.isFetching,a=t.parent.adminClosedComment,r=t.byComment,i=t.status,s=t.order,m=t.totals,c=t.showPackupButton,l=t.handlePackupButton,u=Math.ceil(m/20),p=n.state.current;return a?null:o?Object(d.b)(B.a,null):Object(d.b)("div",{ref:n.commentsWithPaginationElRef},Object(d.b)("div",{className:"CommentList"},"normal"===s&&"open"===i?n.renderNormalComments(e):n.renderComments(e)),u>1&&Object(d.b)(I.a,{className:"comments-pagination",current:p,total:u,onSelect:n.handlePageSelect}),!r&&n.renderCollapsedDivider(),!r&&n.renderCollapsedInfiLoader(),c&&Object(d.b)(x.a,{onClick:l,commentsElRef:n.commentsWithPaginationElRef}))},n.renderModalContent=function(e){var t=n.props,a=t.collapsedInfo,r=t.parent.adminClosedComment,i=t.status,s=t.order,m=t.byComment,c=n.state.collapsed,l=c?n.props:a,u=l.isFetching,p=l.isDrained,b=l.isPrevDrained;if(p&&e.length<=0||r)return Object(d.b)("div",{className:"Comments-empty"},Object(d.b)(F.d,null,Object(d.b)(F.a,null),Object(d.b)("div",null,"还没有评论")));var C={getContainer:function(e){return e}};return Object(d.b)(P.b,Object(o.default)({className:"CommentList",onRef:function(e){n.listEl=e},isLocal:!0,isLoading:u,isPrevDrained:b,isDrained:p,onLoad:function(e){return n.load(n.props,e,!c)},placeholder:Object(d.b)(P.a,{className:"CommentItem",small:!0})},C),"normal"===s&&"open"===i?n.renderNormalComments(e):n.renderComments(e),!m&&n.renderCollapsedDivider(),!m&&n.renderCollapsedComments())},n.renderCommentEdit=function(e){var t=n.props,a=t.parent,r=a.canComment,i=(r=void 0===r?{status:!0}:r).status,s=r.reason,m=a.author,c=(m=void 0===m?{isOrg:!1}:m).isOrg,l=a.type,u=a.id,p=a.adminClosedComment,b=a.questionType,C=t.byComment,h=t.autoFocus,f=t.commentNeedsReview,j=p?"当前内容暂时无法评论":s,g=h&&!C;return i&&!p?Object(d.b)(T.a,Object(o.default)({className:"Comments-".concat("top"===e?"top":"footer"),type:l,id:u,commentNeedsReview:f,onSubmit:n.addComment,autoFocus:g,ownerAuthorIsOrg:c,ownerAuthorIsBrand:"commercial"===b},"top"===e&&{preset:"default",onClick:function(e){O.a.trackEvent(e.target,{id:3905})}})):"top"!==e&&Object(d.b)("div",{className:v()("Comments-disabledText",{"Comments-disabledText--fixed":void 0})},Object(d.b)("div",{className:"Comments-disabledReason"},j))},n.renderBottomButton=function(){var e=n.props.params,t=e.id,o=e.answerId,a=Boolean(o);return Object(d.b)("div",{className:"Comments-footer CommentEditor--normal"},Object(d.b)(N.c,{className:"CommentEditor-startCommentButton",preset:"primary",color:"blue",onClick:function(){return Object(k.b)(Object(R.a)(a?{type:"answer",id:o}:{type:"question",id:t},{utm_content:"comment_area"}),{zaProps:{id:3906}})}},"打开 App 参与站内讨论"))},n}return Object(c.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.byComment,n=e.commentPattern,o=e.parent.adminClosedComment,a=this.state.current;t&&this.scrollToTarget(),"bottom"!==n||o||this.loadByPagination(a)}},{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=t.order,o=t.status,a=t.targetComment,r=t.commentPattern;n===e.order&&o===e.status||("bottom"===r?(this.setState({current:1}),this.loadByPagination(1,e)):this.load(e),this.setState({collapsed:!0}));var i=e.targetComment;!a&&i&&this.setState({collapsed:!i.collapsed})}},{key:"componentDidUpdate",value:function(e){!e.comments.length&&this.props.comments.length&&this.props.byComment&&this.scrollToTarget()}},{key:"componentWillUnmount",value:function(){this.props.dispatch(Object(D.d)(D.b))}},{key:"scrollToTarget",value:function(){var e=this.targetCommentEl,t=this.listEl;if(t&&e){var n=e.getBoundingClientRect(),o=n.top,a=n.height,r=t.getBoundingClientRect(),i=r.top,s=r.height;this.listEl.scrollTop+=o-i-(s-a)/2,e.classList.add("CommentItem--highlighted"),setTimeout(function(){return e.classList.remove("CommentItem--highlighted")},2e3),e.tabIndex=-1,e.focus()}}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,a=t.isAuthor,r=t.comments,i=t.commentPattern,s=t.commentInputPosition,m=t.parent,c=m.author,l=(c=void 0===c?{isOrg:!1}:c).isOrg,u=m.commentPermission,p=m.reviewingCounts,b=m.commentCount,C=m.adminClosedComment,h=t.totals,f=t.status,O=t.order,j=t.onStatusChange,g=t.onOrderChange,y=t.targetLink,k=r.filter(function(e){return!e.isDelete}),P="censor"===u&&a,I=P?{isCommentReviewer:P,onStatusChange:j,status:f,reviewingCounts:p}:{status:f},N=v()({Comments:!0,"Comments--withEditor":!0,"Comments-withPagination":"bottom"===i},n);return Object(d.b)("div",{className:N,ref:function(t){e.commentsElement=t}},Object(d.b)(E.a,Object(o.default)({commentCount:void 0!==b?b:h,commentClosed:C,targetLink:y,order:O,onOrderChange:g,commentPattern:i,isOrg:l,options:this.renderCommentEdit("top")},I)),"top"===s&&this.renderCommentEdit(),"bottom"===i?this.renderPatternContent(k):this.renderModalContent(k),"bottom"===s&&this.renderCommentEdit())}}]),t}(p.Component);M.propTypes={type:u.a.string,parent:u.a.object.isRequired,targetLink:u.a.node,commentNeedsReview:u.a.bool,byComment:u.a.oneOfType([u.a.number,u.a.string]),commentPattern:u.a.string,commentInputPosition:u.a.oneOf(["top","bottom"]),showPackupButton:u.a.bool,handlePackupButton:u.a.func,onPaginationClick:u.a.func,autoFocus:u.a.bool},M.contextTypes={authRequired:u.a.func.isRequired},M.defaultProps={commentInputPosition:"bottom",showPackupButton:!0,autoFocus:!0};var q=Object(C.connect)(function(e,t){var n=t.parent,o=t.parent,a=o.type,r=o.id,i=t.status,s=t.order,m=t.byComment,c=t.commentPattern,d=e.entities,l=e.comments,u="".concat(a,"_").concat(r),p=l.parent,b=l.pagination;"reviewing"===i&&(b=l.reviewing),"reverse"===s&&"open"===i&&(b=l.reverse);var C=[],h=l.collapsed[u]||{};h.ids&&h.ids.length>0&&(C=h.ids.map(function(e){return d.comments[e]}));var v=b[u]||{isPrevDrained:!1,isFetching:!1,isDrained:!1,ids:[]},f=v.isFetching,O=v.isPrevDrained,j=v.isDrained,g=v.ids,y=v.newIds,k=void 0===y?[]:y;return{isFetching:f,isPrevDrained:O,isDrained:j,totals:v.totals,comments:("bottom"!==c?g:k).map(function(e){return d.comments[e]}),collapsedInfo:h,collapsedComments:C,targetComment:d.comments[m],parent:Object.assign({},n,{},p[u])}})(M),_=n(32),U=n(41);var W=function(e){function t(e,n){var o;return Object(r.a)(this,t),(o=Object(s.a)(this,Object(m.a)(t).call(this,e,n))).load=o.load.bind(Object(_.default)(o)),o.addComment=n.authRequired(o.addComment.bind(Object(_.default)(o)),void 0,D.b),o}return Object(c.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){this.load()}},{key:"load",value:function(){this.props.dispatch(Object(f.f)(this.props.commentId))}},{key:"addComment",value:function(e,t){var n=this.props,o=n.parent,a=o.type,r=o.id,i=n.commentId,s=n.dispatch,m=[a,r,e,t.id,i];return s(f.a.apply(void 0,m))}},{key:"render",value:function(){var e,t,n,o=this.props,a=o.onItemLike,r=o.onItemDelete,i=o.onItemFeature,s=o.onItemApprove,m=o.onItemCollapse,c=o.onItemDislike,l=o.onNavBack,u=o.canOperateItem,p=o.isFetching,b=o.comments,C=o.commentNeedsReview,h=o.openComment.collapsed,v=o.parent,f=o.parent.canComment,O=(f=void 0===f?{status:!0}:f).status,j=f.reason,g=o.commentPattern,y=o.commentId,k=this.context.currentUser;return Boolean(k&&b.find(function(e){return e.author&&e.author.member.urlToken===k.urlToken}))&&(t=(e=b.filter(function(e){return e.author&&e.author.member.urlToken!==k.urlToken}))[e.length-1]),p&&!b.length?n=Object(d.b)(P.a,{className:"CommentItem",small:!0}):b.length&&(n=b.map(function(e,t){return Object(d.b)(A.a,{key:t,isConversation:!0,commentNeedsReview:C,canOperate:u,parent:v,comment:e,onLike:a,onDelete:r,onFeature:i,onApprove:s,onCollapse:m,onDislike:c,collapsedShown:h})})),"bottom"===g?Object(d.b)(U.b,{size:"fullPage",onClose:l},Object(d.b)("div",{className:"Comments"},Object(d.b)(E.a,{isConversation:!0,commentPattern:g}),Object(d.b)("div",{className:"CommentList"},n))):Object(d.b)("div",{className:"Comments"},Object(d.b)(E.a,{isConversation:!0,onNavBack:l}),Object(d.b)("div",{className:"CommentList"},n),t&&(O?Object(d.b)(T.a,{id:y,type:"conversation",className:"Comments-footer",replyTo:t,commentNeedsReview:C,onSubmit:this.addComment}):Object(d.b)("div",{className:"Comments-disabledText"},j)))}}]),t}(p.Component);W.propTypes={commentId:u.a.number.isRequired,type:u.a.string,parent:u.a.object.isRequired,commentNeedsReview:u.a.bool},W.contextTypes={currentUser:u.a.object,authRequired:u.a.func.isRequired};var z,H,J,G=Object(C.connect)(function(e,t){var n=t.commentId,o=e.entities.comments,a=e.comments.conversation[n]||{isFetching:!1,isDrained:!1,ids:[]};return{isFetching:a.isFetching,isDrained:a.isDrained,comments:a.ids.map(function(e){return o[e]}),openComment:o[n]}})(W),K=n(67),Q=Object(K.a)(null)((J=H=function(e){function t(e){var n;Object(r.a)(this,t),(n=Object(s.a)(this,Object(m.a)(t).call(this,e))).state={openedCommentId:null,status:"open",order:"normal"},n.like=function(e,t){var o=n.props,a=o.onItemLike,r=o.dispatch;a&&a(e,t),r(Object(f.j)(e))},n.collapse=function(e){var t=n.props,o=t.dispatch,a=t.parent;o(Object(f.g)(e,a.type,a.id))},n.dislike=function(e){return n.props.dispatch(Object(f.h)(e))},n.approve=function(e){var t=n.props,o=t.dispatch,a=t.parent,r=t.type;o(Object(f.b)(e,a.type||r,a.id))},n.handleStatusChange=function(e){n.setState({status:e})},n.handleOrderChange=function(e,t){n.props.onOrderChange&&n.props.onOrderChange(e,t),n.setState({order:e})};var o=e.parent,a=e.dispatch;return n.feature=function(e,t){return a(Object(f.i)(e,o.id,o.type,t))},n.delete=function(e){return a(Object(f.d)(e,o.type,o.id))},n.showConversation=function(e){return n.setState({openedCommentId:e})},n.showComments=function(){return n.setState({openedCommentId:null})},n}return Object(c.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.onMount;e&&e(this.domNode)}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,r=t.containerClassName,i=t.parent,s=t.commentPattern,m=t.type,c=t.parent,l=(c=void 0===c?{}:c).commentPermission,u=c.relationship,p=void 0===u?{}:u,b=c.author,C=void 0===b?{}:b,h=t.needLoadCommentPermission,f=Object(a.a)(t,["className","containerClassName","parent","commentPattern","type","parent","needLoadCommentPermission"]),O=this.context.currentUser,j=void 0===p.isAuthor?O&&C.urlToken&&O.urlToken===C.urlToken:p.isAuthor,g="censor"===l&&!j,y="answer"===m||"article"===m,k=this.state,P=k.openedCommentId,I=k.status,N=k.order,w={commentNeedsReview:g,parent:i,type:m,canOperateItem:y,onShowConversation:this.showConversation,onItemLike:this.like,onItemFeature:this.feature,onItemDelete:this.delete,onItemCollapse:this.collapse,onItemDislike:this.dislike,onItemApprove:this.approve};return Object(d.b)("div",{className:v()("Comments-container",r),ref:function(t){return e.domNode=t}},Object(d.b)(q,Object(o.default)({},f,w,{commentPattern:s,className:v()(n,{"Comments--hidden":P&&"bottom"!==s}),order:N,status:I,onStatusChange:this.handleStatusChange,onOrderChange:this.handleOrderChange,needLoadCommentPermission:h,isAuthor:j})),P&&Object(d.b)(G,Object(o.default)({},f,w,{commentPattern:s,commentId:P,onNavBack:this.showComments})))}}]),t}(p.Component),H.propTypes={type:u.a.string.isRequired,parent:u.a.object.isRequired,onOrderChange:u.a.func,onItemLike:u.a.func,isAuthor:u.a.bool,onMount:u.a.func},H.defaultProps={type:"answer"},H.contextTypes={currentUser:u.a.object,authRequired:u.a.func.isRequired},z=J))||z;t.default=Object(C.connect)()(Q)}}]);
//# sourceMappingURL=column.comments-modals.e866bfe7bfc3e98bfd4d.js.map